<p><strong style="color: rgb(0, 138, 0);"># 玩美股</strong></p><p><strong style="color: rgb(0, 138, 0);">#7</strong></p><p>install.packages("quantmod")</p><p>library(quantmod)</p><p>getSymbols("AAPL")</p><p>chartSeries(AAPL)</p><p>chartSeries(AAPL["2016-01::2020-11"],theme = "white")</p><p><br></p><p>均線20 &lt;- runMean(AAPL[ ,4],n = 20)</p><p>均線60 &lt;- runMean(AAPL[ ,4],n = 60)</p><p>addTA(均線20 ,on=1 ,col="blue")</p><p>addTA(均線60 ,on=1 ,col="red")</p><p><br></p><p><strong style="color: rgb(0, 138, 0);">#8</strong></p><p><span style="background-color: rgb(255, 153, 0);"># 均線策略:當20ma大於60m時全壓買進;當20ma小於60ma時,空手。輸入指令:</span></p><p>position &lt;- Lag(ifelse(均線20&gt;均線60,1,0))</p><p><br></p><p><span style="background-color: rgb(255, 153, 0);"># 解說:positio為一個時間序列・以日為單位如果20m大於60ma,設值為1;</span></p><p><span style="background-color: rgb(255, 153, 0);"># 否則設值為0由於我們是日資料,訊號發生時只能隔天做交易,</span></p><p><span style="background-color: rgb(255, 153, 0);"># 故將這向量全部往後遞延一天。</span></p><p><br></p><p>return &lt;- ROC(Cl(AAPL))*position</p><p><span style="background-color: rgb(255, 153, 0);">#解說:ROC計算:10g(今天收盤價/昨天收盤價)乘上poistion代表。</span></p><p><span style="background-color: rgb(255, 153, 0);">#若1則持有,若0則空手。</span></p><p><br></p><p>return &lt;- return['2017-03-30/2020-11-09']</p><p>#解說:由於我們策略條件是60ma&gt;20m之後才會交易故統計值從2017-03-30開始;</p><p><br></p><p>return &lt;- exp(cumsum(return))</p><p><span style="background-color: rgb(255, 153, 0);"># 解說:cumsu計算累計值即將每一分量之前的值累加起來。</span></p><p><span style="background-color: rgb(255, 153, 0);"># 取exp函數是要計算累計損亦。</span></p><p><span style="background-color: rgb(255, 153, 0);"># (這裡運用數學:1og(a)+1og(b)=1og(ab) sexp(1og(ab))-ab)</span></p><p><br></p><p><br></p><p>plot(return)</p><p><span style="background-color: rgb(255, 153, 0);"># 解說:將累計損益圖畫出來。</span></p><p><span style="background-color: rgb(255, 153, 0);"># 此策略的損益圖形如下,橫軸為時間軸,縱軸為報酬率,1代表原始自有資金100%。</span></p><p><span style="background-color: rgb(255, 153, 0);"># 由圖可知,用這最簡單的策略資產整整翻了將近2.5倍!</span></p><p><br></p><attachment contenteditable="false" data-atts="%5B%5D" data-aid=".atts-2a8e41c9-ac39-4637-91c3-4f0afbe9f05b"></attachment><p><br></p>